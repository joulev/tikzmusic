\newcommand\tmtrill[2][]{
  \begingroup
    \tmset{#1}
    \iftm@usenotecolor
      \def\tm@color{\@nameuse{tm@note@\detokenize{#2}@clr}}
    \fi
    \tm@note@getnote{#2}
    \ifdim\tm@note@average@diff pt<0pt
      \pgfmathtruncatemacro\tm@ornament@pos{ifthenelse(\tm@note@min@diff==-1,9,8)+\tm@lineshift}
    \else
      \pgfmathtruncatemacro\tm@ornament@pos{ifthenelse(\tm@note@max@diff<5,8,\tm@note@max@diff+4)+\tm@lineshift}
    \fi
    \pic[color/.expanded=\tm@color,shift={(\tm@shift@start@x,\tm@shift@start@y)}] at (\tm@note@pos,\tm@ornament@pos*.1) {tm-trill};
  \endgroup
}
\newcommand\tmturn[2][]{
  \begingroup
    \tmset{#1}
    \tm@note@getnote{#2}
    \iftm@usenotecolor
      \def\tm@color{\@nameuse{tm@note@\detokenize{#2}@clr}}
    \fi
    \ifdim\tm@note@average@diff pt<0pt
      \pgfmathtruncatemacro\tm@ornament@pos{ifthenelse(\tm@note@min@diff==-1,9,8)+\tm@lineshift}
    \else
      \pgfmathtruncatemacro\tm@ornament@pos{ifthenelse(\tm@note@max@diff<5,8,\tm@note@max@diff+4)+\tm@lineshift}
    \fi
    \pic[color/.expanded=\tm@color,shift={(\tm@shift@start@x,\tm@shift@start@y)}] at (\tm@note@pos,\tm@ornament@pos*.1) {tm-turn};
  \endgroup
}
\newcommand\tmuppermordent[2][]{
  \begingroup
    \tmset{#1}
    \tm@note@getnote{#2}
    \iftm@usenotecolor
      \def\tm@color{\@nameuse{tm@note@\detokenize{#2}@clr}}
    \fi
    \ifdim\tm@note@average@diff pt<0pt
      \pgfmathtruncatemacro\tm@ornament@pos{ifthenelse(\tm@note@min@diff==-1,9,8)+\tm@lineshift}
    \else
      \pgfmathtruncatemacro\tm@ornament@pos{ifthenelse(\tm@note@max@diff<5,8,\tm@note@max@diff+4)+\tm@lineshift}
    \fi
    \pic[color/.expanded=\tm@color,shift={(\tm@shift@start@x,\tm@shift@start@y)}] at (\tm@note@pos,\tm@ornament@pos*.1) {tm-mordent};
  \endgroup
}
\newcommand\tmlowermordent[2][]{
  \begingroup
    \tmset{#1}
    \tm@note@getnote{#2}
    \iftm@usenotecolor
      \def\tm@color{\@nameuse{tm@note@\detokenize{#2}@clr}}
    \fi
    \ifdim\tm@note@average@diff pt<0pt
      \pgfmathtruncatemacro\tm@ornament@pos{ifthenelse(\tm@note@min@diff==-1,9,8)+\tm@lineshift}
    \else
      \pgfmathtruncatemacro\tm@ornament@pos{ifthenelse(\tm@note@max@diff<5,8,\tm@note@max@diff+4)+\tm@lineshift}
    \fi
    \pic[color/.expanded=\tm@color,shift={(\tm@shift@start@x,\tm@shift@start@y)}] at (\tm@note@pos,\tm@ornament@pos*.1) {tm-mordent};
    \draw[color/.expanded=\tm@color,shift={($(\tm@note@pos,\tm@ornament@pos*.1)+(\tm@shift@start@x,\tm@shift@start@y)$)},line width=.5pt] (0,-.15) -- (0,.15);
  \endgroup
}
\let\tmmordent\tmuppermordent